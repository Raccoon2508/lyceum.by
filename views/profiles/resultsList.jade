include ../stuff/mixins/form-helper
include ../stuff/adminIntarface/cards

extends ../adminLayout
append menuVars
	- var menuPage = 'profiles';
	- var menuSection = 'exams';

block content
	.row
		+pageHeader()
			| Загрузка результатов
		.col-md-5.text-right
			a.btn.btn-default.btn-magnify(href="/admin/pupils/profiles")
				span.btn-label
					i.fa.fa-undo
				| #{'  '}К списку профилей
			a.btn.btn-success.btn-magnify(href="/admin/pupils/profiles/results/assign/" + id + "/" + examNumber)
				span.btn-label
					i.fas.fa-table
				| #{'  '}На "расшифровку"		

	.row
		.col
			h3 Профиль: #{profile.name}, номер экзамена: #{examNumber}, результатов: #{docs.length || 0}
	//- a(href="/admin/pupils/profiles/delete/"+number+"/"+id, class="btn btn-primary") Удалить файлы
	.row
		+simpleCard('Загрузка файлов', 6)
			.row
				.col-sm-6
					form(action="/admin/pupils/profiles/results/"+id+"/"+examNumber, method="post", enctype="multipart/form-data")
						label(for="resultsList") Загрузка csv файла с результатами
						input(type="file", name="csvfile")
						.form-group
							button(type="submit").btn.btn-primary Загрузить
				.col-sm-6
					form(action="/admin/pupils/profiles/results/scans/"+id+"/"+examNumber, method="post", enctype="multipart/form-data")
						label(for="resultScans") Загрузка сканов работ
						input(type="file", name="resultScans", multiple)
						.form-group	
							label(for="resultScansStartNumber") С какого номера начать
							input.form-control(type="number", name="resultScansStartNumber")
						.form-group
							button(type="submit").btn.btn-primary Загрузить	 	
	.row	
		+simpleCard('Загрузка файлов', 12)
			form(action="/admin/pupils/profiles/results/addPoints/"+id+"/"+examNumber, method="post", enctype="multipart/form-data")
				.row
					.col-sm-12
						.form-group
							button.btn.btn-success.pull-right.btn-magnify(type="submit")
								span.btn-label
									i.far.fa-save
								| #{'  '}Сохранить дополнительный баллы	
				
				.table-responsive
					table.table.table-hover
						thead.text-primary
							tr
								th Student
								th ID
								th GradeCamID
								th Missed
								th Points
								th Add points
								th Всего
								th Image
								th Scanned
						tbody		
							each doc, index in docs
								tr
									td #{doc.Student}
										br
										| #{doc.Class}
									td 
										h3 #{doc.ID}
									td #{doc['GradeCam ID']}
										br
										| Version: #{doc.Version}
									td #{doc.Missed}
									td 
										nobr #{doc.Points} / #{doc.Possible}
									td 
										.form-group
											input.form-control(
												type="number",
												value="#{doc.AdditionalPoints}"
												name="addpoints[#{doc._id}]")
									td #{doc.Points + (doc.AdditionalPoints || 0)}
									
									td
										if(doc.image)
											a.resultScanImgContainer(href="/files/#{doc.image.name}", target="_blank")
												img.resultScanImg(src='/files/#{doc.image.name}')
									td #{doc.Scanned.format('h:m:s dd.MM.yyyy')}   
										if(doc.image)
											a.delete-doc-btn.btn.btn-danger.btn-icon.btn-sm(href="/admin/pupils/profiles/results/scans/delete/#{id}/#{examNumber}/#{doc._id}", type='button', rel='tooltip', data-original-title='Удалить', title='Удалить')
												i.fa.fa-times

block scripts
	script(src='/javascripts/Luminous.min.js')
